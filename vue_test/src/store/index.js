/* eslint-disable no-unused-vars */
import Vue from 'vue'
import Vuex from 'vuex'
import axios from 'axios';
import {sortAlbumId, sortAlbumTitle, sortPhotoTitle, sortPhotoId, sorting} from '../helpers/helpers.js'

Vue.use(Vuex)

export default new Vuex.Store({
    state: {
        actionUrl: 'https://jsonplaceholder.typicode.com',
        albums: [],
        photos: [],
        photosOnPage: 25,
        sortType: 'id',
        sortDirection: 1,
        page: 1,
        search: { 
            albumTitle: '', 
            photoTitle: ''
        }
    },
    getters: {
        getAlbums: state => {
            return state.albums.filter(album => {
                return album.title.toLowerCase().indexOf(state.search.albumTitle.toLowerCase()) != -1
            })
        },
        getPhotos: state => {
            let filteredPhotos = state.photos.filter(photo => { 
                return photo.title.toLowerCase().indexOf(state.search.photoTitle.toLowerCase()) != -1
            }).sort(sorting(state.sortDirection, state.sortType));
            return {
                photos: filteredPhotos.splice(state.photosOnPage * (state.page - 1), state.photosOnPage),                
                allPhotos: filteredPhotos
            }
        },
        getSortType: state => {
            return state.sortType
        },
        getSortDirection: state => {
            return state.sortDirection
        },
        getPage: state => {
            return state.page;
        },
        getPhotosOnPage: state => {
            return state.photosOnPage;
        }
    },
    mutations: {
        APPLY_SEARCH(state, search) {
            state.search = search
        },
        GO_PREV_PAGE(state) {
            state.page--;
        },
        GO_NEXT_PAGE(state) {
            state.page++
        },
        SET_SORT_TYPE(state, sortType) {
            if (state.sortType === sortType) {
                state.sortDirection *= -1
            }
            state.sortType = sortType
        }
    },
    actions: {    
        loadAlbums({ commit, state }) {
            const albums = axios.get(`${state.actionUrl}/albums`);
            const photos = axios.get(`${state.actionUrl}/photos`);
            Promise.all([albums, photos]).then(responses => {
                state.albums = responses[0].data;                
                state.photos = responses[1].data;
                state.photos.forEach(photo => {
                    return photo.albumTitle = state.albums.find(album => album.id === photo.albumId).title
                })
            }).catch(e => {
                console.warn(e)
            })
        }
    }
})